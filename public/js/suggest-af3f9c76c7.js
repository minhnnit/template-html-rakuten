"use strict";!function(){ebates.suggest=function(e){var t={justLoadAll:!1,caches:{full:new ebates.cache(40),exact:new ebates.cache(50),empty:new ebates.cache(100)},SIO:{use:!0,start:1,rows:600,field:"n"},result:{rows:10,rowsParam:"rows",map:function(e){return e&&e.response&&e.response.docs&&{size:e.response.docs.length,cat:{one:e.response.docs}}||{size:0,cat:{}}}},params:{query:"q",defs:{}},ajax:{dataType:"json"},start:1,times:{inputThrottle:150,close:300},classes:{highlight:"prox-b"},click:function(){g(),$.post("/suggestHref.htm",{storeId:$(this).data("id"),q:p.data("q"),position:$(this).index()+1},function(e){window.location=$.trim(e)},"text")},show:function(e,t){var s,r=[];if(setTimeout(function(){o.removeClass("loading")},0),t!==m(a.val()))return!0;if(e.one.length){for(s=0;s<e.one.length;s++)r.push('<li class="suggestion" data-id="',e.one[s].d,'"><span class="store-name">',e.one[s].n,'</span><span class="cashback prox-b">',e.one[s].c,"</span></li>");p.find("ul").html(r.join("")).append('<li class="see-all"><a class="prox-b">See all results &gt;</a></li>').end().show().data("q",t),!i&&p.find(".store-name").each(function(){$(this).html(n(t,$(this).text()))})}else h(0);return!0},prepQ:function(e){return $.trim(e).replace(/[^\w\s&'$.]+/g,"").replace(/^\W+/g,"").replace(/\s+/g,"\\").toLowerCase()}},s=$.extend(!0,t,e),n=function(e,t){var n=new RegExp("("+e.replace(/\\/g,"\\s+")+")","gi");return t.replace(n,'<span class="'+s.classes.highlight+'">$1</span>')},a=s.input,o=a.parent(),i=s.justLoadAll,r=s.caches,l={query:0,hide:0},c=i&&"click"||"mousedown",u={url:document.location.protocol+"//"+s.url},d=$.extend(!0,s.ajax,u),p=$("<div>").addClass(s.classes.cont).append($("<ul>")).hide().on(c,".suggestion",s.click).css({left:a.position().left,top:a.position().top+a.height()}),f=function(e){var t=r.exact.get(e),n=function(t){var n=s.result.map(t);n.size&&s.show(n.cat,e)&&a.trigger("s-loaded")&&r.exact.set(n.cat,e)||r.empty.set(!0,e)&&h(0)},l=function(e,t,n){return s.SIO.use&&(s.params.defs[s.result.rowsParam]=t),s.params.defs[s.params.query]=e,$.ajax($.extend(d,{data:s.params.defs})).done(n),!0};return!i&&s.SIO.use&&e.length>=s.SIO.start&&(t=function(){var n=e.substring(0,s.SIO.start),a=r.full.get(n),o=1,i=function(e){var t=s.result.map(e);t.size&&r.full.set(t.cat,n)||r.empty.set(!0,n)};return t=t||a&&1!==a&&a.one&&{one:$.grep(a.one,function(t){return o<=s.result.rows&&new RegExp(e.replace(/[&'$.]+/g,"").replace(/\\/g,"\\\\")).test(m(t[s.SIO.field]).replace(/[&'$.]+/g,""))&&o++})},!t&&(!a||1!==a)&&r.full.set(1,n)&&l(n,s.SIO.rows,i),t}()),o.addClass("loading")&&t&&s.show(t,e)||!t&&l(e,s.result.rows,n)||h(0)},h=function(e){return l.hide=setTimeout(function(){p.hide&&p.hide(),o.removeClass("loading")},e),!e&&p.find("ul").html(""),!0},g=function(){return o.addClass("loading"),setTimeout(function(){clearTimeout(l.hide)},s.times.inputThrottle)},m=s.prepQ,w=function(e){var t,s=p.find("li.selected").removeClass("selected"),n=p.find("li").length,a=e||1;p.is(":visible")&&(s.length&&p.find("li:eq( "+(s.index()+a)%n+" )").addClass("selected")||(s=p.find("li:eq(0)").addClass("selected")),((t=p.offset().top-s.offset().top)>=0||t<-p.height()+s.height())&&p.stop(!0,!1).animate({scrollTop:"+="+(.5*-p.height()-t)}))},v={40:w,38:function(){w(-1)},13:function(){var e=p.find("li.selected");return!e.is(":visible")||e.trigger(c)&&!1}},x=function(){clearTimeout(l.query),l.query=setTimeout(function(){var e=m(a.val());e&&e.length>=s.start&&!r.empty.get(e)&&f(e)||h(0)},s.times.inputThrottle)};a.after(p).attr("autocomplete","off").focus().on("input propertychange",x).one("s-loaded",function(){a.on("blur",function(){h(s.times.close)})}).on("focus",function(){p.find(".suggestion").length&&p.show()}).on("keydown",function(e){return v[e.which]&&v[e.which].call(null)})}}();
//# sourceMappingURL=suggest-af3f9c76c7.js.map
