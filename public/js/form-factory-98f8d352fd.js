"use strict";!function(e,t){var r=function e(t,r){return t.parentNode?t.parentNode.querySelector(r)||e(t.parentNode,r):null};ebates.form=ebates.form||{},ebates.form.init=function(){var a,i,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=this.querySelector(".eb-form-data"),n=o.querySelectorAll("input[type=hidden]"),l=this.querySelector(".eb-susi-hidden-fields"),c=$(this),u=this.querySelector("form"),d=$(u),g=r(u,".eb-modal"),p=r(this,".eb-form-layout"),m=u.getAttribute("data-fields"),f=function(){Array.prototype.map.call(u.querySelectorAll(".validation-required"),function(e){var t=e.parentNode.querySelector(".error");t&&e.parentNode.removeChild(t)}),d.trigger("err-msg-clear")},h={success:function(){var e=ebates.stats.targetPage||"/";ebates.param.get("_csrf")||ebates.param.get("_csrf",e)?$.get("/ajax/getCsrfParam.htm",{},"text").done(function(t){return location.href=ebates.param.add("_csrf",t.trim(),e)}):ebates.stats.rakTargetPage&&""!=ebates.stats.rakTargetPage?location.href=ebates.stats.rakTargetPage:location.href=e},referrer:{use:!0,init:function(){var e=this,r=this.querySelector(".susi-refer-cta .referrer"),a=this.querySelector(".referral-email-address");r&&a&&r.addEventListener("click",function(){for(var r=e.querySelectorAll(".ref-toggle-show"),i=0;i<r.length;i++)r[i].classList.toggle("hide");a.classList.remove("validation-required"),a.focus(),t.trigger("susi-event",["click","Referral"])},!1)}},termClasses:["w-415","eb-legal-popup","pad-5","f-left","pad-25-t","absolute","border-black","bg-w"],captcha:{cont:u.querySelector(".susi-captcha-cont"),field:{eb:{selector:".eb-captcha",isValid:function(){return!!this.value||(this.errorType="empty",this.showMsg("",ebates.form.strings.captcha.empty,"empty"),d.trigger("err-msg",[ebates.form.strings.captcha.empty]),!1)},msg:{clear:function(){var e=this.parentNode,t=e.querySelector(".error");this.value.trim()&&(t&&e.removeChild(t),d.trigger("err-msg-clear",[this]),this.errorType=null)},show:function(){return y.validation.showMsg}}},recaptcha:{selector:".susi-captcha-cont",isValid:function(){var e=this.getAttribute("data-re-captcha-id");return!!(null===e?0:grecaptcha.getResponse(e).length)||(this.errorType="empty",this.showMsg("",ebates.form.strings.recaptcha.empty,"empty"),d.trigger("err-msg",[ebates.form.strings.recaptcha.empty]),!1)},msg:{clear:function(){var e=this.parentNode,t=e.querySelector(".error");t&&e.removeChild(t),d.trigger("err-msg-clear",[this]),this.errorType=null},show:function(){return y.validation.showMsg}}}},cb:null},callback:null,strings:ebates.src.form.strings.en,validation:{showMsg:function(t,r,a){var i=e.createElement("div");d.trigger("clear-messages"),i.classList.add("error"),a&&i.classList.add(a),i.innerHTML=r,this.parentNode.insertBefore(i,this),this.classList.add("in-error"),this.focus&&this.focus()},fields:[{selector:".email-address",isValid:function(){return this.value=this.value.trim(),this.value?!!ebates.regex.email.test(this.value)||(this.errorType="invalid",this.showMsg("",ebates.form.strings.email.invalid,"invalid"),d.trigger("err-msg",[ebates.form.strings.email.invalid]),!1):(this.errorType="empty",this.showMsg("",ebates.form.strings.email.empty,"empty"),d.trigger("err-msg",[ebates.form.strings.email.empty]),!1)},msg:{clear:function(){var e=this.parentNode,t=e.querySelector(".error");if("empty"===this.errorType)return t&&e.removeChild(t),d.trigger("err-msg-clear",[this]),void(this.errorType=null);ebates.regex.email.test(this.value)&&(t&&e.removeChild(t),d.trigger("err-msg-clear",[this]),this.errorType=null)},show:function(){return y.validation.showMsg}}},{selector:".referral-email-address",isValid:function(){return this.value=this.value.trim(),!this.value||(!!ebates.regex.email.test(this.value)||(this.showMsg("",ebates.form.strings.email.invalidFriend,"invalid"),d.trigger("err-msg",[ebates.form.strings.email.invalidFriend]),!1))},msg:{clear:function(){var e=this.parentNode,t=e.querySelector(".error");!ebates.regex.email.test(this.value)&&this.value.trim()||(t&&e.removeChild(t),d.trigger("err-msg-clear",[this]))},show:function(){return y.validation.showMsg}}},{selector:".password",isValid:function(){return this.value?!(this.value.length<6||this.value.length>128)||(this.errorType="invalid",this.showMsg("",ebates.form.strings.password.invalid,"invalid"),d.trigger("err-msg",[ebates.form.strings.password.invalid]),!1):(this.errorType="empty",this.showMsg("",ebates.form.strings.password.empty,"empty"),d.trigger("err-msg",[ebates.form.strings.password.empty]),!1)},msg:{clear:function(){var e=this.parentNode,t=e.querySelector(".error");if("empty"===this.errorType)return t&&e.removeChild(t),d.trigger("err-msg-clear",[this]),void(this.errorType=null);this.value.length>=6&&this.value.length<=128&&(t&&e.removeChild(t),d.trigger("err-msg-clear",[this]),this.errorType=null)},show:function(){return y.validation.showMsg}}}]}},v=function(e){var t=e.selector,r=e.isValid,a=e.msg,i=a.clear,s=a.show,o=u.querySelector(t);o&&(o.isValid=r,o.clearMsg=i,o.showMsg=s())},b=ebates.landingPageLabel||"",y=$.extend(!0,{},h,s);u.defaultOptions=h,"function"==typeof y.strings?y.strings():ebates.js.require(y.strings,function(){return t.trigger("auth-form-strings-loaded",[u])}),Array.prototype.map.call(n,function(e){if(e.classList.contains("required-field"))l.appendChild(e);else{new RegExp("\\b"+e.getAttribute("name")+"\\b").test(m)?l.appendChild(e):o.removeChild(e)}});var w=y.captcha.cont?y.captcha.cont.getAttribute("data-key-name"):null,S=l.querySelector("input.eb-captcha-flag");if(y.captcha.cont&&(w||S)){var k=w||S.getAttribute("name"),q=w?y.captcha.cont.getAttribute("data-date"):S.value,_={key:{src:ebates.src.form.captcha,fn:"captcha",cb:function(){var e=this,t=this.querySelector(y.captcha.field.eb.selector);v(y.captcha.field.eb),t&&(t.addEventListener("input",y.captcha.field.eb.msg.clear,!1),$(t).on("validation-message",y.captcha.field.eb.msg.show())),$(y.captcha.cont).on("do-re-captcha-reset",function(){var t=e.querySelector(".eb-captcha-img-reload"),r=e.querySelector("input.eb-captcha");t&&t.click(),r.value=""}),y.captcha.cb&&y.captcha.cb.bind(y.captcha.cont)()}},"recaptcha-key":{src:ebates.src.form.recaptcha,fn:"grecaptcha",cb:function(){var e=$(y.captcha.cont);y.captcha.cont.classList.add("validation-required"),v(y.captcha.field.recaptcha),e.on("validation-message",y.captcha.field.recaptcha.msg.show()),e.on("re-captcha-checked",y.captcha.cont.clearMsg.bind(y.captcha.cont)),e.on("do-re-captcha-reset",function(){var e=y.captcha.cont.getAttribute("data-re-captcha-id")||0;grecaptcha&&grecaptcha.reset(e)}),y.captcha.cb&&y.captcha.cb.bind(y.captcha.cont)()}}};_[k]&&ebates.js.require(_[k].src,function(){ebates.form[_[k].fn].apply(ebates.form,[q,y.captcha.cont,_[k].cb]),S&&S.parentNode.removeChild(S)})}if(a=o.querySelectorAll("input"),Array.prototype.map.call(a,function(e){var t=e.getAttribute("name"),r=u.querySelector("input.field-placeholder[name="+t+"]");if(r){var a=r.getAttribute("data-field-classes");(a?a.split(/\s/):[]).map(function(t){return e.classList.add(t)}),r.outerHTML=e.outerHTML}try{o.removeChild(e)}catch(e){}}),y.referrer.use){for(var A=u.querySelectorAll(".susi-refer"),C=0;C<A.length;C++)A[C].classList.contains("ref-toggle-hide")&&A[C].classList.remove("hide");y.referrer.init&&y.referrer.init.call(u)}var T=u.getAttribute("focus"),I=T&&u.querySelector("input[name="+T+"]");I&&setTimeout(I.focus.bind(I),0);var L=p&&p.querySelector(".auth-err");if(L&&L.textContent.trim()&&d.trigger("err-msg",L.textContent.trim()),y.callback&&y.callback.call(u),setTimeout(function(){return t.trigger("auth-form-init-ui-ready",[u])},0),ebates.stats.targetPage)for(var F=u.querySelectorAll(".eb-target-page"),P=0;P<F.length;P++)F[P].setAttribute("data-redirect-url",ebates.stats.targetPage);i=u.querySelector("input[name=type]"),b&&i&&i.value!==b&&(i.value=b+" - "+i.value),g&&g.addEventListener("click",function(e){if(e.target.classList.contains("eb-popup")){var a=r(e.target,e.target.getAttribute("data-parent")),i=e.target.getAttribute("data-url"),s={bg:{use:!1},css:{files:null},url:i,classes:{toAdd:y.termClasses,toRemove:["border-grn-t-5","fixed"]},container:a},o=e.target.getAttribute("data-event");if(a&&a.getAttribute("data-url-loaded")!==i){var n=a.querySelector("."+y.termClasses);t.trigger("susi-event",["click",o||"Legal"]),ebates.js.require(ebates.src.modal,function(){a.setAttribute("data-url-loaded",i),ebates.UI.modal("Loading...",s,{close:function(){return a.setAttribute("data-url-loaded","")},ajax:{done:function(){var e=this;n&&a.removeChild(n),$("a.top",this).off("click").on("click",function(){return $("> div",e).animate({scrollTop:0},"fast")})}}})})}}},!1);var x=this.querySelector(".fb-join"),M=this.querySelector(".google-join"),E=this.querySelector(".apple-signin"),N=function(e){var t=e||u,r=t.querySelector("input[name='ebates.signup.promo']"),a=r?$(r).is(":visible")||"radio"===r.type?t.querySelector("input[name='ebates.signup.promo']:checked").value:r.value:"",s=t.querySelector("input[name=split_entry_id]"),o=t.querySelector("input[name=hash]"),n=t.querySelector("input[name=syncRID]"),l={};return s&&(l.split_entry_id=s.value),o&&(l.hash=o.value),a&&(l["ebates.signup.promo"]=a),n&&(l.syncRID=n.value),l.type=i.value,l};ebates.form.suParams=N,x&&x.addEventListener("click",function(e){e.preventDefault(),ebates.FB&&ebates.FB.link?ebates.FB.link($("meta[property='fb.app.redirect.url']").attr("content"),N()):linkWithFacebook&&linkWithFacebook($("meta[property='fb:app_id']").attr("content"),location.protocol+"//"+location.host+"/",$("meta[property='fb.app.redirect.url']").attr("content"),N()),t.trigger("susi-event",["click","FB"])},!1),M&&M.addEventListener("click",function(e){ebates.google&&ebates.google.auth&&ebates.google.auth.init(N()),e.preventDefault(),t.trigger("susi-event",["click","Google"])}),E&&E.addEventListener("click",function(e){if(ebates.cookie.get("enableApple")){var t,r=(["stage.rakuten.com","www.rakuten.com"].indexOf(location.host),N());r.targetPage=location.href,t=$.param({client_id:"com.amadDesign.siwat.client",scope:"email name openid",redirect_uri:location.origin+"/appleUserSignupOrLogin.htm",state:encodeURIComponent(JSON.stringify(r)),response_mode:"form_post",response_type:"code id_token",redirect_params:encodeURIComponent(JSON.stringify(r))}),window.open("https://appleid.apple.com/auth/authorize?"+t,"_blank")}});var j=u.querySelectorAll(".validation-required"),O=p?p.querySelectorAll(".dismiss-form-msg")||[]:[],U=function(e){var r={"Oops. Please provide a valid email address for your friend. If no one referred you, please leave the field blank.":{field:u.querySelector("input.referral-email-address"),cls:"invalid"},"Oops. The email address and/or password you entered is incorrect. Remember, passwords are case-sensitive. Please try again.":{field:u.querySelector(".email-address"),cls:"invalid",msg:ebates.form.strings.error.signIn},invalid_captcha:{field:u.querySelector("input.eb-captcha"),cls:"invalid",msg:ebates.form.strings.captcha.invalid},INVALIDCAPTCHA:{field:u.querySelector("input.eb-captcha"),cls:"invalid",msg:ebates.form.strings.captcha.invalid},invalid_recaptcha:{field:y.captcha.cont,cls:"invalid",msg:ebates.form.strings.recaptcha.invalid},"No Sign Up allowed on Ebates.com for Korea users. If you would like to Sign Up for a new account, please visit Ebates Korea.":{field:u.querySelector(".email-address"),cls:"invalid",msg:ebates.form.strings.error.signIn},invalid_invrecaptcha:{field:y.captcha.cont,cls:"invalid",msg:ebates.form.strings.recaptcha.invalid},email:{field:u.querySelector(".email-address"),cls:"invalid"},"Oops. Please provide a valid email address.":{field:u.querySelector(".email-address"),cls:"invalid"},"Oops. Please provide a valid email address to login":{field:u.querySelector(".email-address"),cls:"invalid"},INVALIDEMAIL:{field:u.querySelector(".email-address"),cls:"invalid",msg:ebates.form.strings.email.invalid},"Oops. Your password is too short. Please provide a password that is 6-128 characters in length.":{field:u.querySelector(".password"),cls:"invalid"},"Your password is too short. Please enter a password 8-12 characters in length.":{field:u.querySelector(".password"),cls:"invalid",msg:ebates.form.strings.password.ascii},"You may only use letters, numbers or simple punctuation (e.g., ! _ # - %) in your password.":{field:u.querySelector(".password"),cls:"invalid",msg:ebates.form.strings.password.ascii},very_weak_or_weak:{field:u.querySelector(".password"),cls:"invalid",msg:ebates.form.strings.password.weak},"your password cannot be the same as you email address.":{field:u.querySelector(".password"),cls:"invalid",msg:ebates.form.strings.password.same},"Your password is too long. Please enter a password 8-128 characters in length.":{field:u.querySelector(".password"),cls:"invalid"},"Oops. The email address already exists. Please try again or sign in.":{field:u.querySelector(".email-address"),cls:"invalid"},"Your account is currently unavailable. Please contact Member Services for assistance.":{field:u.querySelector(".email-address"),cls:"invalid",msg:ebates.form.strings.email.unavailable},"Your account is currently unavailable. Please contact Customer Care for assistance.":{field:u.querySelector(".email-address"),cls:"invalid",msg:ebates.form.strings.email.unavailable}},a=e.message&&e.message.trim()||null;if("fail"===e.status){if(e.dataKey&&"terms_and_conditions"===e.code)return void(location.href="/tcpp.htm?key="+e.dataKey);if(e.code&&"merge_accounts"===e.code)return void(location.href="/auth/member/merge.htm");u.pwdStrengthUIFunc&&"function"==typeof u.pwdStrengthUIFunc.removePwdTooltip&&u.pwdStrengthUIFunc.removePwdTooltip(),$(y.captcha.cont).trigger("do-re-captcha-reset"),"kr_member_signup_denied"==e.code?(ebates.form.strings.error.signIn="This is a Sign In for existing "+ebates.rakutenmode.currentBrandName+".com users. If you would like to Sign Up for a new account, please visit <a href='/kr/' class='f-grn'>Ebates Korea</a>.",$(r[a].field).trigger("validation-message",[ebates.form.strings.error.signIn,r[a].cls]),d.trigger("err-msg",[ebates.form.strings.error.signIn||a])):a&&r[a]?($(r[a].field).trigger("validation-message",[r[a].msg||a,r[a].cls]),d.trigger("err-msg",[r[a].msg||a])):d.trigger("err-msg",[a||ebates.form.strings.error.generic,!0]),u.classList.remove("submission-in-progress"),e.code&&"passwordError"==e.code&&t.trigger("loggly-error",{category:"Ebates Signup password errors on "+window.location.hostname,exception:"Ebates signup password error message - "+a})}else if("success"===e.status){if(void 0!==e.jwttoken&&(ebates.stats.rakTargetPage="https://www.ebates.com/?ebtoken="+e.jwttoken),ebates.form.strings.email.invalidFriend===a)try{localStorage.setItem("invalid_referral_email","true")}catch(e){}if(u.passwordStrengthData&&!u.passwordStrengthData.needStrongPassword){var i=ebates.optim&&ebates.optim.get_custom_su_event&&ebates.optim.get_custom_su_event()||"tracking-error",s={data:[],map:{external:{ec:"Signup Form",ea:"Sign In Success",el:i,et:window.event_type_override},optimizely:{type:"event",eventName:"Signup Form",tags:{event_category:"Signup Form",event_action:"Sign In Success",event_label:i+"",event_type:window.event_type_override+""}}}};try{var o=window.localStorage.getItem("pending-events")?window.localStorage.getItem("pending-events"):[];o.length>0&&(o=JSON.parse(o)),o.push(s),window.localStorage.setItem("pending-events",JSON.stringify(o))}catch(e){}}t.trigger("auth-form-success",[u,e]),y.success.bind(u)()}},D=function(e){if(e.responseText)try{U(JSON.parse(e.responseText))}catch(e){d.trigger("err-msg",[ebates.form.strings.error.generic,!0])}else"M"===ebates.stats.device?$.get("/ajax/getCsrfParam.htm",{},"text").done(function(e){d.find("input[name=_csrf]").val(e.trim()),d.removeClass("submission-in-progress"),setTimeout(function(){B.call({getAttribute:function(){return"Button"}})},0)}):d.trigger("err-msg",[ebates.form.strings.error.generic,!0])},V=function(){j=u.querySelectorAll(".validation-required"),f();var e=!Array.prototype.some.call(j,function(e){return e.isValid&&!e.isValid()});return!e&&u.classList.remove("submission-in-progress"),e},B=function(){var e=this.getAttribute("data-event")||"Button";if(!u.classList.contains("submission-in-progress")&&(u.classList.add("submission-in-progress"),d.trigger("submit-attempt",[e]),V())){var r="post"===u.getAttribute("method")?function(){t.trigger("susi-event",["submit",e]),u.submit()}:function(){$.ajax({url:u.getAttribute("action"),type:"POST",data:d.serialize()+"&isAjax=true"}).done(U).fail(D),t.trigger("susi-event",["submit",e])};"function"==typeof y.beforeSubmit?y.beforeSubmit.bind(u)(r):r()}},R=function(e,t,r){if(r){var a=g&&(g.options||ebates.overlays&&ebates.overlays.activate&&ebates.overlays.activate.options);Array.isArray(a)&&a.length>1&&a[1].url&&(a[1].url=ebates.param.add("err_msg",t,a[1].url),ebates.js.require(ebates.src.modal,function(){ebates.UI.modal.apply(ebates.UI,a)}))}};y.validation.fields.map(v),Array.prototype.map.call(j,function(e){e.addEventListener("input",function(){e.value&&e.clearMsg&&e.clearMsg.apply(this)}),$(e).on("validation-message",function(){e.showMsg&&e.showMsg.apply(this,arguments)})}),u.addEventListener("keypress",function(e){if(13===e.keyCode){if(d.find(".susi-password-field").hasClass("disabled"))return d.find(".continue-with-email-field>a").trigger("click"),d.find('input[type="password"]').focus(),void e.preventDefault();B.call({getAttribute:function(){return"Enter"}}),e.preventDefault()}},!1),u.addEventListener("click",function(e){e.target.classList.contains("submit-button")&&B.call(e.target)},!1),d.on("clear-messages",f),d.on("err-msg",R);for(var J=0,z=O.length;J<z;J++)O[J].addEventListener("click",function(){return d.trigger("clear-messages")},!1);var Y=function(){var e=function(e,r){var a=ebates.optim&&ebates.optim.get_custom_su_event&&ebates.optim.get_custom_su_event()||"tracking-error";t.trigger("stats",{data:[],map:{external:{ec:e,ea:r,el:a,et:window.event_type_override}}}),window.optimizely.push({type:"event",eventName:e,tags:{event_category:e,event_action:r,event_label:a,event_type:window.event_type_override}})},r=!0,a=0,i=0;try{document.querySelector(":-webkit-autofill")}catch(e){r=!1,d.on("input",".email_address",function(){a++}).on("input",".susi-password-field input",function(){i++})}d.one("input",".email-address",function(t){e("Start Sign up","Email"),e("Signup Form","Email Insert Text"),r&&setTimeout(function(){t.target.matches(":-webkit-autofill")&&e("Signup Form","Email Autofill")},100)}).one("focus",".email-address",function(){e("Signup Form","Email Focus")}).one("focus",".susi-password-field input",function(){e("Signup Form","Password Focus")}).one("input",".susi-password-field input",function(t){e("Signup Form","Password Insert Text"),r&&setTimeout(function(){t.target.matches(":-webkit-autofill")&&e("Signup Form","Password Autofill")},100)}),c.find('input[name="ebates.signup.promo"]').on("change",function(t){"SUJOIN10-201503"===t.currentTarget.value?e("Signup Form","Cash Bonus - Click"):e("Signup Form","Walmart - Click")}),c.on("click",".fb-join",function(){e("Start Sign up","Facebook"),e("Signup Form","Facebook - Click"),window.sessionStorage.setItem("social_su_si",!0)}).on("click",".google-join",function(){e("Start Sign up","Google"),e("Signup Form","Google - Click"),window.sessionStorage.setItem("social_su_si",!0)}).on("click",".susi-refer-cta .referrer,.referer-v2",function(){e("Signup Form","Did someone refer you? - Click")}).on("click",".submit-button",function(){e("Signup Form","Join Now - Click"),r||(a<=3&&ebates.regex.email.test(d.find(".email-address").val())&&e("Signup Form","Email Autofill"),i<=3&&d.find(".susi-password-field input").val().length>6&&e("Signup Form","Password Autofill"))}).on("click",".show-join-overlay",function(){e("Signup Form","Member Sign In - Click")}),c.closest(".eb-modal").find(".eb-modal-close").on("click",function(){e("Signup Form","Modal Close - Click")})};setTimeout(function(){d.addClass("init-done"),t.trigger("auth-form-init-done",[u]),"/signUpAjax.do"===u.getAttribute("action")&&(window.optimizely=window.optimizely||[],Y())},0)}}(document,$(document));
//# sourceMappingURL=form-factory-98f8d352fd.js.map
