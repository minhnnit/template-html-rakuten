"use strict";ebates.psmodal=ebates.psmodal||{},ebates.psmodal.init=ebates.psmodal.init||function(){function e(){ebates.js.require(ebates.src.modal,function(){localStorage.setItem("postShopping-"+l,Date.now()+864e5),ebates.UI.modal(p,{url:"/ajax/post-shopping-overlay-old.htm?merchant_id="+l,classes:{toAdd:["op0","border-grn-t-2",g.psmodal,"mw-mar-10-lr"],toRemove:["fixed","border","border-grn-t-5","op0"]},bg:{classes:["op3"]}},{ajax:{done:function(){function e(){o.parentNode.removeChild(o),$(document).trigger("modal-closed"),$(document).trigger("overlay-closed"),$("#eb-modal-bg, .eb-modal-scroller").remove(),ebates.UI.active.modal=null,document.body.classList.remove("overflow-0")}var o=this,t=void 0;"M"===ebates.stats.device&&(c=$(".store-name").text()),t={GA:{ec:"Post Shopping modal_test",ea:"view-shopping_modal",el:c},HD:{et:"view-shopping_modal",el:c}},ebates.psmodal.sendStats(t,!0,!1),$(".eb-modal-close",this).on("click",function(){t={GA:{ec:"Post Shopping modal_test",ea:"shopping_modal_dismiss",el:c},HD:{et:"shopping_modal_dismiss",el:c}},ebates.psmodal.sendStats(t,!0,!1)}),$("#eb-modal-bg, .eb-modal-scroller").on("click",function(){t={GA:{ec:"Post Shopping modal_test",ea:"shopping_modal_dismiss_out",el:c},HD:{et:"shopping_modal_dismiss_out",el:c}},ebates.psmodal.sendStats(t,!0,!1)}),$(".gotIt",this).on("click",function(){e(),t={GA:{ec:"Post Shopping modal_test",ea:"click_shopping_modal_got_it",el:c},HD:{et:"click_shopping_modal_got_it",el:c}},ebates.psmodal.sendStats(t,!0,!1)}),$("a.see-all",this).on("click",function(){e(),t={GA:{ec:"Post Shopping modal_test",ea:"click_shopping_modal_all_categories",el:c},HD:{et:"click_shopping_modal_all_categories",el:c}},ebates.psmodal.sendStats(t,!0,!1)}),"Coupons Only"===$("div.psm-rebate").text()&&e()}}})})}function o(){ebates.UI.modal(p,{url:"/ajax/post-shopping-overlay-dismiss.htm?merchant_id="+l,classes:{toAdd:["op0","border-grn-t-2",g.psmodal,"mw-mar-10-lr"],toRemove:["fixed","border","border-grn-t-5","op0"]},bg:{classes:["op3"]}},{ajax:{done:function(){function e(){o.parentNode.removeChild(o),$(document).trigger("modal-closed"),$(document).trigger("overlay-closed"),$("#eb-modal-bg, .eb-modal-scroller").remove(),ebates.UI.active.modal=null,document.body.classList.remove("overflow-0")}d=$("[data-mail-ms-attr]").length>0?"Microsoft":"Gmail";var o=this,t={GA:{ec:"Post Shopping modal_test",ea:"view-dont-show-confirm-modal",el:c+"-"+d+"-cc-"+r},HD:{et:"view-dont-show-confirm-modal",el:c+"-"+d+"-cc-"+r}};ebates.psmodal.sendStats(t,!1,!1),$(".eb-modal-close",this).on("click",function(){var e={GA:{ec:"Post Shopping modal_test",ea:"click-dont-show-again-dismiss",el:c+"-"+d+"-cc-"+r}};ebates.psmodal.sendStats(e,!1,!1)}),$(".gotIt",this).on("click",function(){e()}),$(".showNoMore",this).on("click",function(){e()})}}})}function t(){ebates.js.require(ebates.src.modal,function(){ebates.UI.modal(p,{url:"/ajax/post-shopping-overlay-link.htm?merchant_id="+l,classes:{toAdd:["op0","border-grn-t-2",g.link,"mw-mar-10-lr"],toRemove:["fixed","border","border-grn-t-5","op0"]},bg:{classes:["op3"]}},{ajax:{done:function(){function e(){o.parentNode.removeChild(o),$(document).trigger("modal-closed"),$(document).trigger("overlay-closed"),$("#eb-modal-bg, .eb-modal-scroller").remove(),ebates.UI.active.modal=null,document.body.classList.remove("overflow-0")}d=$("[data-mail-ms-attr]").length>0?"Microsoft":"Gmail";var o=this,t={GA:{ec:"Email Link Flow",ea:"view permission priming modal",el:d+" -cc-"+r},HD:{et:"view permission priming modal",el:d+"-cc-"+r}};ebates.psmodal.sendStats(t,!1,!0),$(".eb-modal-close",this).on("click",function(){var e={GA:{ec:"Email Link Flow",ea:"click permission priming x to dismiss link",el:d+" -cc-"+r},HD:{et:"click permission priming x to dismiss link",el:d+"-cc-"+r}};ebates.psmodal.sendStats(e,!1,!0)}),$(".mayBeLater",this).on("click",function(){e()}),$(".privacyPolicy",this).on("click",function(){e()}),$(".google-account",this).on("click",function(){s()})}}})})}function s(){function e(e,o){$.ajax({url:"/connectEbatesUserWithGoogle.do?code="+o,type:"GET",datatype:"json",headers:{"content-type":"application/json"},data:e,success:function(){a("/ajax/post-shopping-overlay-success.htm?merchant_id=","success")},error:function(){a("/ajax/post-shopping-overlay-unsuccessful.htm?merchant_id=","failure")}})}var o=$("meta[property='google:app_id']").attr("content");gapi.auth2.authorize({client_id:o,scope:"https://www.googleapis.com/auth/gmail.readonly email profile",response_type:"code permission",access_type:"offline",include_granted_scopes:"true"},function(o){if(o.code){var t={},s=$("input.csrfInput").val();t[$("input.csrfInput").attr("name")]=s,t.isAjax=!0,e(t,o.code)}})}function a(e,o){ebates.js.require(ebates.src.modal,function(){ebates.UI.modal(p,{url:e+l,classes:{toAdd:["op0","border-grn-t-2","w-400","mw-mar-10-lr"],toRemove:["fixed","border","border-grn-t-5","op0"]},bg:{classes:["op3"]}},{ajax:{done:function(){function e(){t.parentNode.removeChild(t),$(document).trigger("modal-closed"),$(document).trigger("overlay-closed"),$("#eb-modal-bg, .eb-modal-scroller").remove(),ebates.UI.active.modal=null,document.body.classList.remove("overflow-0")}var t=this,a={GA:{ec:"Email Link Flow",ea:"view email linking confirmation modal",el:o},HD:{et:"view email linking confirmation modal",el:o}};ebates.psmodal.sendStats(a,!1,!0,o),$("a.success",this).on("click",e),$(".actSetting",this).on("click",function(){var t={GA:{ec:"Email Link Flow",ea:"click email linking account settings text link",el:o},HD:{et:"click email linking account settings text link",el:o}};ebates.psmodal.sendStats(t,!1,!0,o),e()}),$(".eb-modal-close",this).on("click",function(){var e={GA:{ec:"Email Link Flow",ea:"click email linking x to dismiss link",el:o},HD:{et:"click email linking x to dismiss link",el:o}};ebates.psmodal.sendStats(e,!1,!0,o)}),$(".google-account",this).on("click",s)}}})})}var i=$(document),n=window.location.pathname+Date.now(),l="",c="",d="",r=!0,m=0,p="M"===ebates.stats.device?'<div class="lh-50 center"><span class="fa-spinner fa-pulse f-50 absolute ht-50 w-50"></span><div>':'<span class="fa-spinner fa-pulse f-50 f-grn absolute h-v-centered ht-50 w-50"></span>',g={psmodal:"M"===ebates.stats.device?"stretch":"w-600",link:"M"===ebates.stats.device?"stretch":"w-500"},u=function(){"visible"===document.visibilityState&&clearTimeout(m)},h=function(){document.removeEventListener("visibilitychange",u),"visible"!==document.visibilityState?document.addEventListener("visibilitychange",u):clearTimeout(m)},b=function(){var s=$(".excludedStore").text();l===s||"never"===localStorage.getItem("dontShowModelAgain")?e():ebates.js.require(ebates.src.modal,function(){localStorage.setItem("postShopping-"+l,Date.now()+864e5),ebates.UI.modal(p,{url:"/ajax/post-shopping-overlay.htm?merchant_id="+l,classes:{toAdd:["op0","border-grn-t-2",g.psmodal,"mw-mar-10-lr"],toRemove:["fixed","border","border-grn-t-5","op0"]},bg:{classes:["op3"]}},{ajax:{done:function(){function e(){s.parentNode.removeChild(s),$(document).trigger("modal-closed"),$(document).trigger("overlay-closed"),$("#eb-modal-bg, .eb-modal-scroller").remove(),ebates.UI.active.modal=null,document.body.classList.remove("overflow-0")}var s=this,a=$(".specialCTA").text(),i=void 0;"M"===ebates.stats.device&&(c=$(".store-name").text()),"Yes! Tell Me More"===a&&(r=!1),d=$("[data-mail-ms-attr]").length>0?"Microsoft":"Gmail",i={GA:{ec:"Post Shopping modal_test",ea:"view-shopping_modal",el:c+"-"+d+"-cc-"+r},HD:{et:"view-shopping_modal",el:c+"-"+d+"-cc-"+r}},ebates.psmodal.sendStats(i,!0,!1),$(".eb-modal-close",this).on("click",function(){var e={GA:{ec:"Post Shopping modal_test",ea:"shopping_modal_dismiss",el:c+"-"+d+"-cc-"+r},HD:{et:"shopping_modal_dismiss",el:c+"-"+d+"-cc-"+r}};ebates.psmodal.sendStats(e,!0,!1)}),$(".specialCTA",this).on("click",function(){ebates.js.require(ebates.src.form.google,function(){ebates.js.require("https://apis.google.com/js/api.js",function(){gapi.load("auth2")})}),t()}),$(".gotIt",this).on("click",function(){e(),i={GA:{ec:"Post Shopping modal_test",ea:"click_shopping_modal_got_it",el:c+"-"+d+"-cc-"+r},HD:{et:"click_shopping_modal_got_it",el:c+"-cc-"+r}},ebates.psmodal.sendStats(i,!1,!1)}),$("a.see-all",this).on("click",function(){e(),i={GA:{ec:"Post Shopping modal_test",ea:"click_shopping_modal_all_categories",el:c+"-"+d+"-cc-"+r}},ebates.psmodal.sendStats(i,!1,!1)}),$(".showNoMore",this).on("click",function(){localStorage.setItem("dontShowModelAgain","never"),e(),o()}),"Coupons Only"===$("div.psm-rebate").text()&&e()}}})})};null!==localStorage.getItem("isGoogleAccountLinked")&&"No"===localStorage.getItem("isGoogleAccountLinked")&&a("/ajax/post-shopping-overlay-unsuccessful.htm?merchant_id=","failure"),null!==localStorage.getItem("isGoogleAccountLinked")&&"Yes"===localStorage.getItem("isGoogleAccountLinked")&&a("/ajax/post-shopping-overlay-success.htm?merchant_id=","success"),$("div.fromHelp").on("click",function(){var e=$(".fromHelp button").text();ebates.js.require(ebates.src.form.google,function(){ebates.js.require("https://apis.google.com/js/api.js",function(){gapi.load("auth2")})}),l=$(".getStoreId").text(),"Yes! Tell Me More"===e&&(r=!1),t()}),"psm"===ebates.param.get("psm")&&b(),i.on("click",'a[href*="-xfas"]',function(){var e=$(this).attr("href");e=e.substring(0,e.indexOf("xfas")),c=e.replace("/","").split(".").shift(),l=e.split("_").pop().split("-").shift(),this.href=ebates.param.add("origin",n,this.href),setTimeout(h,1e3)}),window.addEventListener("storage",function(e){var o="postShopping-"+l;e.key&&e.newValue===n&&(localStorage.getItem(o)<+Date.now()||"null"===localStorage.getItem(o))&&(clearTimeout(m),"visible"!==document.visibilityState&&(m=setTimeout(b,6e4)))}),ebates.psmodal.sendStats=function(e,o,t,s){return e.HD.ec=t?"Email Link Flow":"Post Shopping modal_test",o&&(e.HD.v="EBA118a"),s&&(e.HD.el=s),$(document).trigger("stats",{data:["send","event",e.GA.ec,e.GA.ea,e.GA.el],map:{external:e.HD}}),!0},"pospopUpWindow"===window.name&&"MCS"===ebates.param.get("social_media")&&"other"===ebates.param.get("type")&&window.opener&&window.opener.postMessage("PosMSLinkSuccess",location.origin),window.addEventListener("message",function(e){if("PosMSLinkSuccess"==e.data){e.source.close(),$(document).trigger("close-modals"),setTimeout(function(){a("/ajax/post-shopping-overlay-success.htm?merchant_id=","success")},500)}},!1)},"loading"!==document.readyState?ebates.psmodal.init():window.addEventListener("DOMContentLoaded",ebates.psmodal.init);
//# sourceMappingURL=post-shopping-modal-f234dd0221.js.map
