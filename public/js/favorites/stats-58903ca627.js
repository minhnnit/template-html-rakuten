"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){function e(e){return Number(e.toFixed(2))}function t(t){if(window.PerformancePaintTiming){var a=performance.getEntriesByType("paint");Array.isArray(a)&&a.length>0&&(t.firstPaint=e(a[0].startTime))}}function a(t){var a=performance,s=a.timing;if("object"===(void 0===s?"undefined":_typeof(s))){var n=s.navigationStart;t.dnsTime=e(s.domainLookupEnd-s.domainLookupStart),t.connectionTime=e(s.connectEnd-s.connectStart),t.timeToFirstByte=e(s.responseStart-s.requestStart),t.domComplete=e(s.domComplete-n),t.domContentLoaded=e(s.domContentLoadedEventStart-n),t.documentLoad=e(s.loadEventStart-n),t.domInteractive=e(s.domInteractive-n)}}function s(t){var a=performance.getEntriesByType("navigation")[0];t.dnsTime=e(a.domainLookupEnd-a.domainLookupStart),t.connectionTime=e(a.connectEnd-a.connectStart),t.timeToFirstByte=e(a.responseStart-a.requestStart),t.domComplete=e(a.domComplete),t.domContentLoaded=e(a.domContentLoadedEventStart),t.documentLoad=e(a.loadEventStart),t.domInteractive=e(a.domInteractive),a.encodedBodySize&&(t.bodySize=a.encodedBodySize)}function n(){if(window.performance){var e={};return e.numOfScript=0,e.numOfCss=0,e.numOfImg=0,e.sizeOfScripts=0,e.sizeOfCss=0,performance.getEntries().forEach(function(t){/.*css$/.test(t.name)&&t.encodedBodySize>0?(e.numOfCss+=1,e.sizeOfCss+=t.encodedBodySize):"script"===t.initiatorType&&t.encodedBodySize>0?(e.numOfScript+=1,e.sizeOfScripts+=t.encodedBodySize):"img"===t.initiatorType&&(e.numOfImg+=1)}),window.PerformanceNavigationTiming?s(e):a(e),t(e),e}return null}function i(e,t){function a(){setTimeout(function(){try{var a=n();a&&e(a)}catch(e){t&&"function"==typeof t&&t(e)}},o)}var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t||{};if(!e||"function"!=typeof e)throw new Error("submitHandler is required and must be a function");var i=s.delay,o=void 0===i?200:i;return window.addEventListener("load",a),function(){window.removeEventListener("load",a)}}!function(e,t,a){var s,n,o,r;window.optimizely=window.optimizely||[],ebates=ebates||{},ebates.cookie={set:function(e,a,s){var n=new Date;n.setTime(n.getTime()+864e5*s),t.cookie=e+"="+a+";expires="+n.toUTCString()+";path=/;"},get:function(e){var a=t.cookie.split(e+"=");return 2===a.length&&a.pop().split(";").shift()}},ebates.GA=ebates.GA||{},ebates.stats=ebates.stats||{},ebates.GA.opts={cookieDomain:location.hostname,forceSSL:!0,useAmpClientId:!0,sampleRate:2},ebates.GA.id="stage.rakuten.com"===location.hostname||"preview-www.rakuten.com"===location.hostname||"www.rakuten.com"===location.hostname?"UA-1707619-3":"UA-1707619-8",ebates.user=ebates.user||{},ebates.user.guid&&(ebates.GA.opts.userId=ebates.user.guid),ebates.user.membership=ebates.user.status&&/^REGISTERED/.test(ebates.user.status)?"member":"non-member",ebates.user.isDataSharingAllowed?function(e,t,a,s,n,i,o){e.GoogleAnalyticsObject=n,e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},e[n].l=+new Date,i=t.createElement(a),o=t.getElementsByTagName(a)[0],i.async=1,i.src="//www.google-analytics.com/analytics.js",o.parentNode.insertBefore(i,o)}(window,t,"script",0,"ga"):window.ga=function(){},ga(function(){ebates.GA.ready=!0}),ga("create",ebates.GA.id,ebates.GA.opts),ga("require","linkid","linkid.js"),ebates.user.status&&ga("set",{dimension1:ebates.user.status,dimension2:ebates.user.membership}),ebates.session&&ebates.session.id&&ga("set",{dimension3:ebates.session.id}),ebates.user.guid&&ga("set",{dimension9:ebates.user.guid}),ebates.user.id_last_digit&&ga("set",{dimension13:ebates.user.id_last_digit}),s=ebates.cookie.get("ESID"),s&&ga("set",{dimension12:s}),ga("send","pageview"),ebates.stats.send=function(a,s){var n,i,o,r,d=e.noop,c={send:{event:"y",pageview:"y"}};"function"==typeof window.CustomEvent&&function(){var e=new CustomEvent("stats-event",{detail:s});t.dispatchEvent(e)}(),s&&e.isArray(s.data)&&s.data.length>1?(n=s.data[s.data.length-1],r=function(){ebates.pathInMap(c,[s.data[0],s.data[1]])&&ga(function(){ga.apply(null,s.data)}),!ebates.GA.ready&&d()},i="object"===(void 0===n?"undefined":_typeof(n))&&"function"==typeof n.hitCallback&&n.hitCallback,i?(o=setTimeout(i,ebates.stats.timeout),d=function(){clearTimeout(o),i()},s.data[s.data.length-1]={hitCallback:d},e.when.apply(e,ebates.stats.webAnalytics(s)).then(r,r)):(ebates.stats.webAnalytics(s),r())):s.map&&ebates.stats.webAnalytics(s)},ebates.stats.webAnalytics=function(t){var a,n,i,o,r=[],d={pageview:{"/address-guidedhelp-bigfatpayment-view":"Address - Guided Help: Big Fat Payment - View","/address-guidedhelp-bigfatpayment-click":"Address - Guided Help: Big Fat Payment - Click","/address-guidedhelp-bigfatpayment-complete":"Address - Guided Help: Big Fat Payment - Complete"},event:{"Shopping Trip":{"ABP detected":"Merchant Session - AdBlock Plus enabled"},Video:{"In-Store Cash Back":"Video - In-Store Cash Back",Welcome:{CBMS:"Video - Cash Back Made Simple"}},Overlays:{"Address - Address Overlay - Click":"Address - Address Overlay - Click","Address - Address Overlay - Complete":"Address - Address Overlay - Complete","Address - Address Overlay - View":"Address - Address Overlay - View","How to earn cash back":"How to Earn Cash Back Overlay"},Cashstar:{"cashstar-changed-mind":"Cashstar - Changed Mind","cashstar-get-card":"Cashstar - Get Card","cashstar-sign-in":"Cashstar - Sign-In"},"/merchant-store-page-visit":"Merchant Store Page Visit","/captcha":"Captcha","/create-password-failure":"Create Password - Failure","/change-password-request-failure":"Change Password - Request Failure","/password-force-reset-failure":"Password Force Reset - Failure","/change-password-display":"Change Password - Display","/change-password-request":"Change Password - Request",Pages:{Welcome:"View - Ebates Welcome page",Luxe:{Landing:"View - Ebates Luxury page","All Stores":"View - Ebates Luxury All Stores page"},HP:{Video:"View - Ebates test homepage"}}}};if(t.map&&t.map.optimizely&&(t.map.optimizely.tags?window.optimizely.push(t.map.optimizely):window.optimizely.push(["trackEvent",t.map.optimizely])),t.data&&(i=ebates.pathInMap(d,t.data.slice(1))),i=i||t.map&&t.map.internal,void 0!==i&&i&&(n=t.entities?t.entities:[{entityType:i,instanceId:"userId"}],a={eventType:i,entities:n},r.push(e.ajax({url:"/frontendEvents.do",data:JSON.stringify(a),type:"POST",contentType:"application/json"}))),t.map&&t.map.external&&ebates.stats.externalUrl){if(o={uid:"",guid:ebates.user.guid,sid:ebates.session.id,rsid:ebates.user.rsid,ts:Date.now()-ebates.stats.timeDelta,url:location.href,dt:ebates.stats.device},s&&(o.esid=s),ebates.user.status&&(o.us=ebates.user.status),"function"==typeof navigator.sendBeacon&&ebates.stats.unload&&(!/(iPad|iPhone|iPod)/.test(navigator.userAgent)||/(CriOS|FxiOS)/g.test(navigator.userAgent)))return navigator.sendBeacon(ebates.stats.externalUrl,JSON.stringify(e.extend(o,t.map.external))),r;r.push(e.ajax({url:ebates.stats.externalUrl,data:JSON.stringify(e.extend(o,t.map.external)),type:"POST",contentType:"text/plain",timeout:2*ebates.stats.timeout}))}return r},ebates.stats.global=function(){var t=e("body"),s=["SignIn","SignUp"],n={"Forgot Click":".tablet-overlay .forgotOverlay","Signin Click":".tablet-overlay .show-join-overlay.loginIe8","Signup Click":".tablet-overlay .show-join-overlay.joinIe8"},i=function(t){var s=e(this).closest(".tablet-overlay").find('input[name="type"]');a.trigger("stats",{data:["send","event","Overlays",t.data.action,s.val&&s.val()||"other"]})};e.each(n,function(e,a){t.on("click",a,{action:e},i)}),e.each(s,function(e,t){var n=ebates.cookie.get(t),i=n&&n.split("|")||[];if(i.length>1){var o=t===s[1],r=i[0],d=i[1].replace(/_/g," "),c={name:{SignIn:"Complete Log In",SignUp:"Complete Sign Up"},method:{form:"Email",FB:"Facebook",Google:"Google"}},l={eventType:c.name[t],eventProps:{method:c.method[r]||r}};if(o){var u=ebates.amplitude||{userProps:{referred_by:null,referrer_share_source:null}},p=u.userProps,g=p.referred_by,m=p.referrer_share_source,b={has_referrer:!("REF"!==ebates.user.registrationType&&!g)};b.has_referrer&&(g&&(b.referred_by=g),m&&(b.referrer_share_source=m)),Object.assign(l.eventProps,b),ebates.cookie.set("opt-signup",n)}a.trigger("stats",{data:["send","event",t,r,d],map:{amp:l}}),setTimeout(function(){return ebates.cookie.set(t,0,-1)},0)}})},ebates.stats.trackNavIds=function(e,t){var a,s,n,i=t;i?ebates.cookie.set("navigation_id",i):this.getAttribute&&(a=this.getAttribute("data-navigation-id"),s=this.getAttribute("href"),n=s&&-1!==s.indexOf("-xfas"),i=n?ebates.stats.parentNavId+"|"+a:a,ebates.cookie.set("navigation_id",i))},ebates.stats.trackClick={queue:{},runningEventCount:0,unload:function(){var t=function(e){ebates.stats.send(null,ebates.stats.trackClick.queue[e])};ebates.stats.unload=!0,e.ajaxSetup({async:!1}),Object.keys(ebates.stats.trackClick.queue).map(t)},send:function(e,t,a){var s="double-tracking-off-"+a,n={key:++ebates.stats.trackClick.runningEventCount,send:function(){ebates.stats.send(null,t),delete ebates.stats.trackClick.queue[n.key],e.classList.remove(s)}};t&&!e.classList.contains(s)&&(e.classList.add(s),ebates.stats.trackClick.queue[n.key]=t,setTimeout(n.send,ebates.stats.timeout/2))},ga:function(){var e={category:this.getAttribute("data-click-category")};e.action=this.getAttribute("data-click-action"),e.action&&(e.data=["send","event",e.category,e.action],e.label=this.getAttribute("data-click-label"),e.label&&e.data.push(e.label),ebates.stats.trackClick.send(this,{data:e.data},"ga"))},external:function(){var e=this,t=e.getAttribute("data-event-signature").split(","),a={};t.length&&(t.map(function(t){var s=e.getAttribute("data-"+t);null!==s&&(a[t]=s)}),ebates.stats.trackClick.send(this,{map:{external:a}},"ext"))},amplitude:function(){var e=this,t=e.getAttribute("data-amp-evt-sig"),a=t?e.getAttribute("data-amp-evt-sig").split(","):[],s={},n={eventType:e.getAttribute("data-amp-evt-type")};a.length&&(a.map(function(t){var a=e.getAttribute("data-amp-"+t);null!==a&&(s[t]=a)}),n.eventProps=s),ebates.stats.trackClick.send(this,{map:{amp:n}},"amp")}},ebates.stats.sendDataError=function(e){var t="";e&&e.message&&("undefined"!=typeof _LTracker&&_LTracker.push({Type:"Data Error",Message:e.message,page:location.href,device:ebates.stats.device,guid:ebates.user.guid,label:e.label?e.label:{}}),e.label&&(t="object"===_typeof(e.label)?JSON.stringify(e.label):e.label),ga&&ga("send","event","Data Error",e.message,t))},ebates.pathInMap=function(e,t){return e&&"string"!=typeof e?ebates.pathInMap(e[t.shift()],t):e},a.off("stats"),a.on("stats",ebates.stats.send),window.addEventListener("error",function(e){var t,s,n,i,o={};e.message&&e.filename&&(t=300,o.host=new RegExp(window.location.protocol+"//"+window.location.host,"gi"),o.file=new RegExp(e.filename,"gi"),n=e.message.substring(0,t),n+=n.length===t?"...":"",i=e.error&&e.error.stack?e.error.stack.replace(/\s+/gi," ").replace(o.file,"FILE").replace(e.message,"ERR"):"",s=(e.filename+":"+(e.lineno||"")+":"+(e.colno||"")+"|"+i).replace(o.host,""),s+=s.length===t?"...":"",a.trigger("stats",{data:["send","event","JS",n,s]}))},!1),e(function(){ebates.stats.global(),a.on("click","a[data-navigation-id]",ebates.stats.trackNavIds).on("set-nav-id",ebates.stats.trackNavIds).on("contextmenu webkitmouseforcewillbegin","a[data-navigation-id]",function(){ebates.stats.trackNavIds.call(this),setTimeout(e.proxy(ebates.cookie.set,ebates.cookie,"navigation_id",0,-1),10*ebates.stats.timeout)}).on("click","[data-click-category]",ebates.stats.trackClick.ga).on("click","[data-event-signature]",ebates.stats.trackClick.external).on("click","[data-amp-evt-type]",ebates.stats.trackClick.amplitude),window.addEventListener("unload",ebates.stats.trackClick.unload,!1)});try{window.localStorage.getItem("pending-events")&&(n=JSON.parse(window.localStorage.getItem("pending-events")),n.length>0&&(n.forEach(function(e){setTimeout(function(){ebates.stats.send(null,e)},100)}),window.localStorage.removeItem("pending-events"))),window.localStorage.getItem("social_su_si")&&ebates.param.get("social_media")&&(o=ebates.optim&&ebates.optim.get_custom_su_event&&ebates.optim.get_custom_su_event()||"tracking-error",r={data:[],map:{external:{ec:"Signup Form",ea:"Sign In Success",el:o},optimizely:{type:"event",eventName:"Signup Form",tags:{event_category:"Signup Form",event_action:"Sign In Success",event_label:o}}}},setTimeout(function(){ebates.stats.send(null,r)},100))}catch(e){}ebates.user&&ebates.user.loggedIn?ebates.cookie.get("_mall_uuid_cp")&&ebates.cookie.get("grm_cp")||e.get("/ajax/rat_cookie.htm"):ebates.cookie.get("_mall_uuid_cp")||e.get("/ajax/rat_cookie.htm"),i(function(a){ebates.page&&["home","allstores","store"].indexOf(ebates.page.type)>=0&&(a.browser=ebates.getBrowser().name,e(t).trigger("stats",{data:[],map:{external:{ec:"Page performance",et:"Navigation",ea:ebates.page.type,el:a}}}))})}($,document,$(document))}();
//# sourceMappingURL=stats-58903ca627.js.map
